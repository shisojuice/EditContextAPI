(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))d(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const p of i.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&d(p)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function d(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();const a=document.getElementById("editor-canvas"),s=a.getContext("2d"),c=16;s.font=`${c}px monospace`;const t=new EditContext;a.editContext=t;const l=10,u=30;function h(){s.clearRect(0,0,a.width,a.height),s.fillStyle="black",s.fillText(t.text,l,u)}function f(e){return s.measureText(e).width}function v(){let e=!0;setInterval(()=>{const n=f(t.text.substring(0,t.selectionEnd))+l;s.clearRect(n,u-c,2,c),e&&t.selectionStart===t.selectionEnd&&(s.fillStyle="black",s.fillRect(n,u-c,2,c)),e=!e},500)}function m(e){s.clearRect(e*c+l,u-c,2,c)}v();function x(){const e=a.getBoundingClientRect();t.updateControlBounds(e)}x();window.addEventListener("resize",x);t.addEventListener("compositionstart",e=>{a.classList.add("is-composing")});t.addEventListener("compositionend",e=>{a.classList.remove("is-composing")});t.addEventListener("textupdate",e=>{h()});t.addEventListener("textformatupdate",e=>{h();const n=e.getTextFormats();for(const r of n){const{rangeStart:d,rangeEnd:o,underlineStyle:i,underlineThickness:p}=r,y=f(t.text.substring(0,d)),E=f(t.text.substring(0,o)),g=u+3;s.beginPath(),s.moveTo(l+y,g),s.lineTo(l+E,g),s.stroke()}});t.addEventListener("characterboundsupdate",e=>{const n=[];for(let r=e.rangeStart;r<e.rangeEnd;r++)n.push(T(r));t.updateCharacterBounds(e.rangeStart,n)});function T(e){const n=f(t.text.substring(0,e)),r=f(t.text[e]),d=a.offsetLeft+n,o=a.offsetTop;return DOMRect.fromRect({x:d,y:o+c+10,width:r,height:c})}a.addEventListener("keydown",async e=>{if(e.key=="v"&&(e.ctrlKey||e.metaKey)){const n=await navigator.clipboard.readText();t.updateText(t.selectionStart,t.selectionEnd,n),t.updateSelection(t.selectionStart+n.length,t.selectionStart+n.length),h()}if(e.key=="ArrowLeft"){const n=t.selectionStart,r=Math.max(n-1,0);e.shiftKey||(t.updateSelection(r,r),m(n))}else if(e.key=="ArrowRight"){const n=t.selectionEnd,r=Math.min(n+1,t.text.length);e.shiftKey||(t.updateSelection(r,r),m(n))}});
